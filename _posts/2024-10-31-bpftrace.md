---
layout: post
title: bpftrace总结
categories: eBPF, bpftrace
description: bpftrace 总结，常用命令
keywords: eBPF, hook，可编程
---
不仅要在所有地方`hook`，还要在那里可编程，`eBPF`让一切成为现实，而`bpftrace`让这一过程变的简单。  

## 内置变量 & 函数

## 常用

### uprobe
查看用户态函数参数及返回值例子：   
sum.c:  
```
#include <stdio.h>

int sum(int a, int b) {
    return a+b;
}

int main(void)
{
    printf("sum 2 + 3 = %d\n", sum(2, 3));
    printf("sum 3 + 2 = %d\n", sum(3, 2));
    return 0;
}
```
uprobe, sum.bt:  
```
#!/usr/bin/env bpftrace

uprobe:./sum:"sum"
{
    printf("args: %d + %d\n", arg0, arg1);
}

uretprobe:./sum:"sum"
{
    printf("result: %d\n", reg("ax"));
}
```
`./sum.bt` attach uprobe之后，再运行`./sum`.     
```
Attaching 2 probes...
args: 2 + 3
result: 5
args: 3 + 2
result: 5
```
